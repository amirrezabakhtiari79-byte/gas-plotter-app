name: Build Android APK

on:
push:
branches:
- main
- master
workflow_dispatch:

jobs:
build-android:
name: Build APK using official Kivy Docker image
runs-on: ubuntu-latest

container: kivy/buildozer:latest

steps:
  - name: Checkout repository
    uses: actions/checkout@v4

  - name: Set ownership of the checkout directory
    run: |
      sudo chown -R kivy:kivy .
  
  - name: Manually install Android build-tools 34.0.0
    # This step prevents "aidl not found" errors by ensuring the build tools are installed.
    run: |
      yes | sdkmanager "build-tools;34.0.0"

  - name: Build the APK with Buildozer
    # This command will read all settings from your buildozer.spec file.
    run: |
      buildozer -v android debug

  - name: Upload the APK as a workflow artifact
    uses: actions/upload-artifact@v4
    with:
      name: package-apk
      path: bin/*.apk
